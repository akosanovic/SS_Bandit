<style>
  /*========== Dark Theme Settings ===============*/
  #collection-5c520e2f575d1fc8d4894937 {
    background-color: #000000 !important;
  }
  /* Style website when gif active */

  /* navigation and label above animation */
  .gif-active .Site.loaded {
    position: relative;
    z-index: 3;
  }
  .gif-active .html-block {
    visibility: hidden;
  }
  .gif-active .html-block.activeLink {
    visibility: visible;
  }

  .gifContainer,
  .gifOutContainer {
    z-index: 1;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;

    background-position: 0;
    background-repeat: no-repeat;
    background-image: "";
    transition: all 0.5s ease;
    background-size: cover;
  }

  /* Out Gif over Start Gif */
  .gifOutContainer {
    z-index: 2;
  }
  /* Video Background */

  /* Hide images on prod */
  .Main-content .image-block,
  .Main-content .video-block {
    display: none;
  }
  /* Show images on edit */
  .Main-content .sqs-editing .image-block,
  .Main-content .sqs-editing .video-block {
    display: block;
  }

  h2 a {
    border-bottom-color: rgba(255, 255, 255, 0.3);
  }
  h2 a:hover {
    color: rgba(255, 255, 255, 0.8);
    border-bottom-color: rgba(255, 255, 255, 0.15);
  }
</style>

<script>
  $("document").ready(function() {
    // DOM
    var $body = $("body");
    var $gifContainer = null;
    var $gifOutContainer = null;
    var $links = $body.find(".Main-content a");
    var gifActive = false;
    var outImageUrl = "";

    var linkCounterGroup = [];

    for (var i = 0; i < $links.length; i++) {
      $link = $($links[i]);
      counter = 0;
      linkCounterGroup.push([$link, counter]);

      $link.hover(
        function() {
          setBackgroundImage(event, counter);
          counter++;
        },
        function(){
          setTimeout(()=> {
            removeBackgroundImage();
          }, 1760) 
        }
      );
    }

    // Event Binding
    for (var i = 0; i < linkCounterGroup.length; i++) {
      $link = linkCounterGroup[i][0];
      counter = linkCounterGroup[i][1];
    }

    // Toggle Background image on hover
    function removeBackgroundImage() {
      if (this.outImageUrl) {
        this.$gifOutContainer = $('<div class="gifOutContainer"></div>');
        this.$gifOutContainer.css({
          "background-image": 'url("' + this.outImageUrl + '")',
          "background-repeat": "no-repeat",
          "background-size": "cover"
        });

        console.log("mouse out ", this.$gifOutContainer);

        $body.prepend(this.$gifOutContainer);

        // Remove all animation
        setTimeout(() => {
          $('.activeLink').removeClass('activeLink');
         
          // remove gif start container
          $('.gifContainer').remove();
          this.gifContainer = null;

          $('.gifOutContainer').remove();
          this.$gifOutContainer = null;
          this.outImageUrl = null;

          $body.removeClass("gif-active");
        }, 2000);
      }
    }

    function setBackgroundImage(e, counter) {
      console.log("counter on mouse  over ", counter);
      if (!$body.hasClass('sqs-edit-mode-active')) {
        $body.addClass("gif-active");
      }

      link = $(e.target);

      // find image src
      linkContainer = link.closest(".sqs-block-html").addClass('activeLink');
      imageContainer = linkContainer.next(".row");
      backgroundImages = imageContainer.find("img");

      startImgUrl = $(backgroundImages[0]).attr("src");
      this.outImageUrl = $(backgroundImages[1]).attr("src");

      startImgUrl = startImgUrl.split("?")[0] + "?" + counter;
      this.outImageUrl = this.outImageUrl.split("?")[0] + "?" + counter;

      //   Prepend image container to body
      if (this.outImageUrl) {
        this.$gifContainer = $('<div class="gifContainer"></div>');
        this.$gifContainer.css({
          "background-image": 'url("' + startImgUrl + '")',
          "background-repeat": "no-repeat",
          "background-size": "cover"
        });
        $body.prepend(this.$gifContainer);
      }
    }
  });
</script>
